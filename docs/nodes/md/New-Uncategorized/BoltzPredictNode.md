# Boltz Predict

<div style="display: flex; gap: 20px; align-items: flex-start; margin-bottom: 20px;">
<div style="flex: 1; min-width: 0;">

Runs Boltz structure prediction from a prepared Boltz YAML configuration and its auxiliary files. Produces ranked structure files and confidence metrics, and optionally ligand-binding affinity predictions when requested in properties. Seeds are offset per sequence to ensure varied sampling across multiple sequences in one YAML.

</div>
<div style="flex: 0 0 300px;"><img src="../../../images/previews/New-Uncategorized/BoltzPredictNode.png" alt="Preview" style="width: 100%; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" /></div>
</div>

## Usage

Use this node after building sequences, constraints, templates, and properties and combining them into a valid Boltz YAML with its auxiliary files. Connect the YAML and files outputs from the Boltz YAML Combiner, set prediction parameters (sampling, recycling, step scale), and optionally enable affinity-related options if affinity is requested. The outputs include ranked structure files, confidence JSON, and optional affinity JSON.

## Inputs

<div style="overflow-x: auto;">
<table style="table-layout: fixed; width: 100%;">
<colgroup>
<col style="width: 15%;">
<col style="width: 10%;">
<col style="width: 15%;">
<col style="width: 30%;">
<col style="width: 30%;">
</colgroup>
<thead><tr><th>Field</th><th>Required</th><th>Type</th><th>Description</th><th>Example</th></tr></thead>
<tbody>
<tr><td style="word-wrap: break-word;">boltz_yaml</td><td>True</td><td style="word-wrap: break-word;">BOLTZ_YAML</td><td style="word-wrap: break-word;">The Boltz YAML configuration generated by the Boltz YAML Combiner. Must include at least one sequence and adhere to Boltz schema.</td><td style="word-wrap: break-word;">{'version': 1, 'sequences': [{'protein': {'id': 'A', 'sequence': 'AAAA', 'msa': 'empty'}}]}</td></tr>
<tr><td style="word-wrap: break-word;">boltz_files</td><td>True</td><td style="word-wrap: break-word;">BOLTZ_FILES</td><td style="word-wrap: break-word;">Auxiliary files referenced by the YAML (e.g., A3M MSAs, template PDBs). Keys are filenames and values are file contents.</td><td style="word-wrap: break-word;">{'msa_1.a3m': '>A\nAAAA', 'template_1.pdb': 'ATOM ...'}</td></tr>
<tr><td style="word-wrap: break-word;">seed</td><td>True</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Base RNG seed for reproducibility. Each sequence in the YAML uses an offset of this seed to diversify samples.</td><td style="word-wrap: break-word;">42</td></tr>
<tr><td style="word-wrap: break-word;">recycling_steps</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Number of recycling iterations during prediction.</td><td style="word-wrap: break-word;">3</td></tr>
<tr><td style="word-wrap: break-word;">sampling_steps</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Number of diffusion sampling steps for structure generation.</td><td style="word-wrap: break-word;">200</td></tr>
<tr><td style="word-wrap: break-word;">diffusion_samples</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">How many independent diffusion samples to generate per run.</td><td style="word-wrap: break-word;">1</td></tr>
<tr><td style="word-wrap: break-word;">max_parallel_samples</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Degree of parallelism for sampling (hardware dependent).</td><td style="word-wrap: break-word;">5</td></tr>
<tr><td style="word-wrap: break-word;">step_scale</td><td>False</td><td style="word-wrap: break-word;">FLOAT</td><td style="word-wrap: break-word;">Diffusion step scale (temperature-like control). Higher values generally increase exploration.</td><td style="word-wrap: break-word;">1.638</td></tr>
<tr><td style="word-wrap: break-word;">output_format</td><td>False</td><td style="word-wrap: break-word;">STRING</td><td style="word-wrap: break-word;">Desired structure file format for outputs. Options: pdb or mmcif.</td><td style="word-wrap: break-word;">pdb</td></tr>
<tr><td style="word-wrap: break-word;">num_workers</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Number of worker processes. Set to 0 to disable multiprocessing.</td><td style="word-wrap: break-word;">0</td></tr>
<tr><td style="word-wrap: break-word;">max_msa_seqs</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Maximum number of MSA sequences to use.</td><td style="word-wrap: break-word;">8192</td></tr>
<tr><td style="word-wrap: break-word;">subsample_msa</td><td>False</td><td style="word-wrap: break-word;">BOOLEAN</td><td style="word-wrap: break-word;">Whether to subsample MSA sequences.</td><td style="word-wrap: break-word;">False</td></tr>
<tr><td style="word-wrap: break-word;">num_subsampled_msa</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Number of MSA sequences to use if subsampling is enabled.</td><td style="word-wrap: break-word;">1024</td></tr>
<tr><td style="word-wrap: break-word;">use_potentials</td><td>False</td><td style="word-wrap: break-word;">BOOLEAN</td><td style="word-wrap: break-word;">Enable inference-time potentials to improve quality at the cost of speed.</td><td style="word-wrap: break-word;">False</td></tr>
<tr><td style="word-wrap: break-word;">write_full_pae</td><td>False</td><td style="word-wrap: break-word;">BOOLEAN</td><td style="word-wrap: break-word;">If true, outputs include full Predicted Aligned Error (PAE) matrices.</td><td style="word-wrap: break-word;">False</td></tr>
<tr><td style="word-wrap: break-word;">write_full_pde</td><td>False</td><td style="word-wrap: break-word;">BOOLEAN</td><td style="word-wrap: break-word;">If true, outputs include full Predicted Distance Error (PDE) matrices.</td><td style="word-wrap: break-word;">False</td></tr>
<tr><td style="word-wrap: break-word;">affinity_mw_correction</td><td>False</td><td style="word-wrap: break-word;">BOOLEAN</td><td style="word-wrap: break-word;">Applies molecular weight correction when computing affinity (only used if affinity property is requested).</td><td style="word-wrap: break-word;">False</td></tr>
<tr><td style="word-wrap: break-word;">sampling_steps_affinity</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Sampling steps specifically for affinity prediction (if requested).</td><td style="word-wrap: break-word;">200</td></tr>
<tr><td style="word-wrap: break-word;">diffusion_samples_affinity</td><td>False</td><td style="word-wrap: break-word;">INT</td><td style="word-wrap: break-word;">Number of diffusion samples specifically for affinity prediction (if requested).</td><td style="word-wrap: break-word;">5</td></tr>
</tbody>
</table>
</div>

## Outputs

<div style="overflow-x: auto;">
<table style="table-layout: fixed; width: 100%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 35%;">
<col style="width: 25%;">
</colgroup>
<thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Example</th></tr></thead>
<tbody>
<tr><td style="word-wrap: break-word;">structures.pdb</td><td style="word-wrap: break-word;">PDB</td><td style="word-wrap: break-word;">Dictionary mapping ranked structure filenames to content. Filenames are prefixed by sequence names for multi-sequence YAMLs.</td><td style="word-wrap: break-word;">{'sequence_0_rank_001.pdb': 'ATOM ...', 'sequence_0_rank_002.pdb': 'ATOM ...'}</td></tr>
<tr><td style="word-wrap: break-word;">confidence.json</td><td style="word-wrap: break-word;">JSON</td><td style="word-wrap: break-word;">Dictionary of confidence-related outputs (e.g., pLDDT/PAE metrics) keyed by filenames.</td><td style="word-wrap: break-word;">{'sequence_0_confidence.json': '{"pLDDT": [...], "PAE": [...]}'}</td></tr>
<tr><td style="word-wrap: break-word;">affinity.json</td><td style="word-wrap: break-word;">JSON</td><td style="word-wrap: break-word;">Dictionary of affinity prediction outputs keyed by filenames. Only populated if an affinity property is present and at least one ligand exists in sequences.</td><td style="word-wrap: break-word;">{'sequence_0_affinity.json': '{"Kd_pred": 1.2e-8, "details": {...}}'}</td></tr>
</tbody>
</table>
</div>

## Important Notes
- **YAML validity**: The YAML must contain at least one sequence and follow the Boltz schema used by the Boltz YAML Combiner.
- **Affinity requirements**: Affinity prediction is only allowed if the YAML includes an affinity property and at least one ligand sequence; otherwise the node will raise an error.
- **Multiple sequences**: If YAML contains multiple sequences, the node runs them with seed offsets (seed + index) and prefixes output filenames with the detected sequence names.
- **Output format**: The output structure format is controlled by output_format (pdb or mmcif); filenames reflect the chosen format.
- **Performance**: max_parallel_samples, num_workers, and use_potentials significantly affect runtime and resource usage.
- **MSA handling**: Ensure any MSA or template filenames referenced by the YAML exist in boltz_files; large MSAs may be truncated via max_msa_seqs or sampled if subsample_msa is enabled.

## Troubleshooting
- **Error: Boltz YAML must contain at least one sequence**: Check that boltz_yaml.sequences is present and non-empty from the YAML Combiner.
- **Error: Boltz files must be a dictionary**: Provide the auxiliary files mapping as a dict of filename -> content.
- **Error: Affinity prediction requires at least one ligand sequence**: Add a ligand to sequences and ensure an affinity property is included, or disable affinity-related options.
- **Empty or missing outputs**: Verify sampling_steps and diffusion_samples are reasonable, and confirm that template/MSA filenames in YAML match keys in boltz_files.
- **Unexpected runtime or slow performance**: Reduce diffusion_samples or sampling_steps, lower max_parallel_samples, or disable use_potentials to speed up.
- **Invalid parameter ranges**: Ensure integers and floats are within the documented bounds (e.g., recycling_steps >= 1, step_scale within allowed range).
